<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, width=device-width" />

    <link rel="stylesheet" href="./css/repsoil.css" />
    <link rel="stylesheet" href="./css/dashboard2.css" />

    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap"
    />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>
  </head>
  <body>
    <div class="desktop-2">
      <div class="search-and-profile-account-bar">
        <img
          class="entypodots-three-vertical-icon"
          alt=""
          src="./img/entypodotsthreevertical.svg"
        /><img
          class="search-and-profile-account-bar-child"
          alt=""
          src="./img/ellipse-1@2x.png"
        />
        <div class="as-shakirin">As Shakirin</div>
      </div>
      <div class="side-menu">
        <div class="side-navigation"></div>
        <div class="side-menu-child"></div>
        <img class="logo-icon" alt="" src="./img/logo.svg" />
        <div class="settings-side">
          <b class="settings">Settings</b
          ><img
            class="icon-chevron-down1"
            alt=""
            src="./img/-icon-chevron-down.svg"
          /><img class="icon-filter" alt="" src="./img/-icon-filter.svg" />
        </div>
        <div class="dashboard-side" id="dashboardSideContainer">
          <b class="dashboard">Dashboard</b
          ><img
            class="icon-chevron-down2"
            alt=""
            src="./img/-icon-chevron-down2.svg"
          /><img class="icon-grid" alt="" src="./img/-icon-grid.svg" />
        </div>
        <div class="device-side">
          <div class="device-side-child"></div>
          <b class="device">Device</b
          ><img
            class="icon-chevron-down3"
            alt=""
            src="./img/-icon-chevron-down.svg"
          /><img class="icon-mobile" alt="" src="./img/-icon-mobile.svg" />
        </div>
        <div class="data-side">
          <b class="data">Data</b
          ><img
            class="icon-chevron-down4"
            alt=""
            src="./img/-icon-chevron-down.svg"
          /><img
            class="icon-bar-chart-alt"
            alt=""
            src="./img/-icon-bar-chart-alt.svg"
          />
        </div>
        <div class="log-out">
          <b class="log-out1">Log Out</b
          ><img class="icon-log-out" alt="" src="./img/-icon-log-out.svg" />
        </div>
        <div class="help">
          <img
            class="icon-clipboard-list"
            alt=""
            src="./img/-icon-clipboard-list.svg"
          /><b class="help-getting">Help & Getting Started</b>
        </div>
      </div>
      <div class="repsoil-bar">
        <div class="repsoil-bar-child"></div>
        <div class="online">Online</div>
        <img class="repsoil-bar-item" alt="" src="./img/ellipse-2.svg" /><b
          class="temperature"
          >Temperature</b
	      ><b class="temperature-c"><table id="data-table"></table></b><b class="celcius-c">Celcius (Â°C)</b
        ><img class="repsoil-bar-inner" alt="" src="./img/ellipse-4.svg" /><img
          class="mask-group-icon"
          alt=""
          src="./img/mask-group.svg"
        />
      </div>
      <div class="moisture-bar">
        <div class="repsoil-bar-child"></div>
        <div class="online">Online</div>
        <img class="repsoil-bar-item" alt="" src="./img/ellipse-2.svg" /><b
          class="temperature"
          >Moisture</b
	      ><b class="temperature-c"><p id="col2"></p>2</b><b class="percentage">Percentage (%)</b>
        <img
          class="mask-group-icon1"
          alt=""
          src="./img/mask-group1.svg"
        /><img class="moisture-1-icon" alt="" src="./img/moisture-1.svg" />
      </div>
      <div class="ec-bar">
        <div class="repsoil-bar-child"></div>
        <div class="online">Online</div>
        <img class="repsoil-bar-item" alt="" src="./img/ellipse-2.svg" /><b
          class="temperature"
          >EC</b
	      ><b class="temperature-c"><p id="col3">4</p></b><b class="percentage">(uS/m)</b
        ><img class="mask-group-icon1" alt="" src="./img/mask-group2.svg" />
      </div>
      <b class="device1">Device</b
      ><img class="energy-1-icon" alt="" src="./img/energy-1.svg" />
      <div class="dropdown-menu">
        <div class="dropdown-menu-child"></div>
        <img
          class="icon-chevron-down5"
          alt=""
          src="./img/-icon-chevron-down.svg"
        />
        <div class="select-repsoil">Select Repsoil</div>
        <img class="icon-computer1" alt="" src="./img/-icon-computer.svg" />
      </div>
      <div class="search-bar">
        <div class="search-bar-child"></div>
        <div class="search-using-keywords">
          Search using keywords or name ...
        </div>
        <img class="vector-icon" alt="" src="./img/vector.svg" /><img
          class="close-searchbar-icon"
          alt=""
        />
      </div>
    </div>
<script src="https://apis.google.com/js/api.js"></script>
    <script>
        // Client ID and API key from the Developer Console
const CLIENT_ID = 'Y815591560606-gfblp4dkqc9ie8akoom2jg319dj38unp.apps.googleusercontent.com';
const API_KEY = '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';

// Array of API discovery doc URLs for APIs used by the quickstart
const DISCOVERY_DOCS = [
  'https://sheets.googleapis.com/$discovery/rest?version=v4',
];

// Authorization scopes required by the API; multiple scopes can be
// included, separated by spaces.
const SCOPES = 'https://www.googleapis.com/auth/spreadsheets.readonly';

let authorizeButton;
let signoutButton;

function handleClientLoad() {
  gapi.load('client:auth2', initClient);
}

function initClient() {
  gapi.client
    .init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: DISCOVERY_DOCS,
      scope: SCOPES,
    })
    .then(() => {
      // Listen for sign-in state changes.
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

      // Handle the initial sign-in state.
      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
      authorizeButton.onclick = handleAuthClick;
      signoutButton.onclick = handleSignoutClick;
    })
    .catch((err) => {
      console.log(`Error initializing client: ${err}`);
    });
}

function updateSigninStatus(isSignedIn) {
  if (isSignedIn) {
    authorizeButton.style.display = 'none';
    signoutButton.style.display = 'block';
    getDataFromSheet();
  } else {
    authorizeButton.style.display = 'block';
    signoutButton.style.display = 'none';
  }
}

function handleAuthClick(event) {
  gapi.auth2.getAuthInstance().signIn();
}

function handleSignoutClick(event) {
  gapi.auth2.getAuthInstance().signOut();
}

function getDataFromSheet() {
  gapi.client.sheets.spreadsheets.values
    .get({
      spreadsheetId: '1waWDtnICSNIqL3sY5Z9iuhrBmCRY4GXiw1tDL20knPk',
      range: 'Sheet1!A:A1',
    })
    .then((response) => {
      const data = response.result.values;

      if (data.length > 0) {
        const tableBody = document.querySelector('#data-table tbody');
        tableBody.innerHTML = '';

        for (let i = 0; i < data.length; i++) {
          const row = data[i];
          const rowData = [];

          // Extract specific columns
          if (row[0] !== '0') {
            rowData.push(row[0]);
          }
          if (row[1] !== '0') {
            rowData.push(row[1]);
          } 
            if (row[2] !== '0') {
            rowData.push(row[2]);
          }

          if (rowData.length > 0) {
            const newRow = document.createElement('tr');

            rowData.forEach((value) => {
              const cell = document.createElement('td');
              cell.appendChild(document.createTextNode(value));
              newRow.appendChild(cell);
            });

            tableBody.appendChild(newRow);
          }
        }
      }

      // Schedule the next request
      setTimeout(() => getDataFromSheet(), 1000);
    })
    .catch((err) => {
      console.error(`Error getting data from sheet: ${err}`);
    });
}

// Load the API and make the sign-in button visible.
function handleClientLoad() {
  gapi.load('client:auth2', initClient);
}

// Initialize the API client library and set up sign-in state listeners.
function initClient() {
  gapi.client
    .init({
      apiKey: API_KEY,
      clientId: CLIENT_ID,
      discoveryDocs: DISCOVERY_DOCS,
      scope: SCOPES,
    })
    .then(() => {
      // Listen for sign-in state changes.
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

      // Handle the initial sign-in state.
      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

      // Add event listeners to buttons
      authorizeButton.addEventListener('click', handleAuthClick);
      signoutButton.addEventListener('click', handleSignoutClick);
    })
    .catch((err) => {
      console.error(`Error initializing client: ${err}`);
    });
}

// Update the UI appropriately after sign in status changes
function updateSigninStatus(isSignedIn) {
  if (isSignedIn) {
    authorizeButton.style.display = 'none';
    signoutButton.style.display = 'block';
    getDataFromSheet();
  } else {
    authorizeButton.style.display = 'block';
    signoutButton.style.display = 'none';
  }
}

// Handle sign-in button click event
function handleAuthClick(event) {
  gapi.auth2.getAuthInstance().signIn();
}

// Handle sign-out button click event
function handleSignoutClick(event) {
  gapi.auth2.getAuthInstance().signOut();
}

// Start the authorization flow
function startAuth() {
  gapi.auth2.getAuthInstance().signIn();
}

// End the authorization flow
function signOut() {
  gapi.auth2.getAuthInstance().signOut();
}

// Load the API and make the sign-in button visible.
gapi.load('client:auth2', initClient);
    </script>
  </body>
</html>
